<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Chat Meeting – TranscripTonic</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="../icon.png" />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap");
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "Google Sans", "Roboto", sans-serif; background: #fff; color: #202124; height: 100vh; display: flex; font-size: 14px; }
    a { color: #2D9AC7; text-decoration: none; }
    a:hover { text-decoration: underline; }
    
    .sidebar { width: 280px; border-right: 1px solid #e8eaed; background: #f8f9fa; display: flex; flex-direction: column; transition: width 0.25s; overflow: hidden; }
    .sidebar.collapsed { width: 64px; }
    .sb-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; gap: 8px; border-bottom: 1px solid #e8eaed; }
    .sb-title { font-size: 16px; font-weight: 500; color: #202124; }
    .toggle-btn { background: transparent; border: 1px solid #dadce0; color: #5f6368; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
    .toggle-btn:hover { background: #f1f3f4; }
    
    .chat-list { flex: 1; overflow-y: auto; padding: 8px 12px 16px; display: flex; flex-direction: column; gap: 4px; }
    .chat-item { border: 1px solid transparent; background: #fff; padding: 12px 16px; border-radius: 8px; cursor: pointer; display: flex; flex-direction: column; gap: 4px; position: relative; transition: all 0.2s; }
    .chat-item:hover { background: #f1f3f4; }
    .chat-item.active { border-color: #2D9AC7; background: #e8f0fe; }
    .chat-item-title { font-size: 14px; font-weight: 500; line-height: 1.3; color: #202124; }
    .chat-item-meta { font-size: 12px; color: #5f6368; }
    
    .new-chat-btn { margin: 12px; background: #2D9AC7; color: #fff; border: none; padding: 12px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }
    .new-chat-btn:hover { background: #1557b0; box-shadow: 0 2px 8px rgba(26,115,232,0.3); }
    .new-chat-btn.full { width: calc(100% - 24px); }
    .sidebar.collapsed .new-chat-btn .label { display: none; }
    .sidebar.collapsed .new-chat-btn { width: 40px; padding: 12px 0; }

    .main { flex: 1; display: flex; flex-direction: column; height: 100%; }
    .top-bar { padding: 20.5px 24px; border-bottom: 1px solid #e8eaed; display: flex; align-items: center; justify-content: space-between; gap: 16px; background: #fff; }
    .meeting-title { margin: 0; font-size: 20px; font-weight: 500; color: #202124; }
    .model-tag { font-size: 12px; background: #e8f0fe; color: #2D9AC7; padding: 4px 8px; border-radius: 12px; font-weight: 500; }

    .messages { flex: 1; overflow-y: auto; padding: 24px; display: flex; flex-direction: column; gap: 24px; background: #fff; }
    .msg { display: flex; gap: 12px; max-width: 800px; }
    .msg.assistant { align-self: flex-start; }
    .msg.user { align-self: flex-end; flex-direction: row-reverse; }
    .msg.user .bubble { background: #2D9AC7; color: #fff; }
    
    .avatar { width: 40px; height: 40px; border-radius: 20px; background: #f1f3f4; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 500; color: #5f6368; flex-shrink: 0; }
    .msg.user .avatar { background: #2D9AC7; color: #fff; }
    .msg.assistant .avatar { background: #34a853; color: #fff; }
    
    .bubble { background: #f8f9fa; border: 1px solid #e8eaed; padding: 16px 20px; border-radius: 16px; font-size: 14px; line-height: 1.5; white-space: pre-wrap; max-width: 600px; }
    .msg.user .bubble { background: #2D9AC7; color: #fff; border-color: #2D9AC7; }
    .msg.assistant .bubble { background: #f8f9fa; border-color: #e8eaed; }

    .composer { border-top: 1px solid #e8eaed; padding: 16px 24px; display: flex; flex-direction: column; gap: 12px; background: #fff; }
    .composer-row { display: flex; gap: 12px; align-items: flex-end; }
    textarea { flex: 1; resize: none; background: #fff; border: 1px solid #dadce0; color: #202124; padding: 12px 16px; font-family: inherit; font-size: 14px; line-height: 1.4; border-radius: 24px; min-height: 48px; transition: border-color 0.2s; }
    textarea:focus { outline: none; border-color: #2D9AC7; box-shadow: 0 0 0 1px #2D9AC7; }
    .send-btn { background: #2D9AC7; color: #fff; border: none; padding: 12px 24px; font-weight: 500; cursor: pointer; border-radius: 20px; font-size: 14px; transition: all 0.2s; }
    .send-btn:hover { background: #1557b0; box-shadow: 0 2px 8px rgba(26,115,232,0.3); }
    .status-line { font-size: 12px; color: #5f6368; display: flex; justify-content: space-between; }

    .empty-state { font-size: 14px; color: #5f6368; text-align: center; padding: 48px 24px; }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; padding: 24px; overflow-y: auto; z-index: 1000; }
    .modal { background: #fff; border-radius: 16px; width: min(600px,100%); padding: 24px; display: flex; flex-direction: column; gap: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
    .modal h2 { margin: 0; font-size: 20px; color: #202124; font-weight: 500; }
    .modal label { font-size: 14px; font-weight: 500; color: #202124; display: block; margin-bottom: 8px; }
    .modal input, .modal select { background: #fff; border: 1px solid #dadce0; color: #202124; padding: 12px 16px; border-radius: 8px; font-size: 14px; width: 100%; transition: border-color 0.2s; }
    .modal input:focus, .modal select:focus { outline: none; border-color: #2D9AC7; box-shadow: 0 0 0 1px #2D9AC7; }
    .modal textarea { height: 120px; resize: vertical; }
    .modal-actions { display: flex; gap: 12px; justify-content: flex-end; }
    .btn { background: transparent; border: 1px solid #dadce0; color: #2D9AC7; padding: 10px 24px; font-size: 14px; border-radius: 20px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
    .btn:hover { background: #f8f9fa; }
    .btn.primary { background: #2D9AC7; color: #fff; border-color: #2D9AC7; }
    .btn.primary:hover { background: #1557b0; }
    .btn.danger { border-color: #ea4335; color: #ea4335; }
    .btn.danger:hover { background: #fce8e6; }

    .hidden { display: none !important; }
    .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    .sidebar.collapsed .hide-when-collapsed { display: none; }
    .sidebar.collapsed .new-chat-btn.full { width: auto; padding: 12px; }
    .sidebar.collapsed .chat-item-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .sidebar.collapsed .chat-item-meta { display: none; }
    .sidebar.collapsed .chat-item { padding: 12px 8px; }
    .sidebar.collapsed .chat-item-title { font-size: 12px; }

    .banner { background: #e8f0fe; border-bottom: 1px solid #dadce0; padding: 12px 24px; font-size: 14px; color: #2D9AC7; }
    .banner.warn { background: #fef7e0; color: #ea8600; }
    .banner.error { background: #fce8e6; color: #ea4335; }
  </style>
</head>
<body>
  <aside class="sidebar" id="sidebar">
    <div class="sb-header">
      <span class="sb-title hide-when-collapsed">Chat Meeting</span>
      <button class="toggle-btn" id="toggleSidebar" title="Toggle sidebar">≡</button>
    </div>
  <button class="new-chat-btn full" id="btnNewChat" title="Nuova chat"><span class="icon">＋</span><span class="label"> Nuova Chat</span></button>
    <div class="chat-list" id="chatList"></div>
  </aside>
  <main class="main">
    <div id="bannerContainer"></div>
    <div class="top-bar">
      <h1 class="meeting-title" id="chatTitle">Caricamento...</h1>
      <div class="model-tag" id="modelTag" title="Modello usato"></div>
    </div>
    <div class="messages" id="messages"></div>
    <div class="composer" id="composer">
      <div class="composer-row">
  <textarea id="inputMessage" placeholder="Scrivi e premi Invio (Shift+Invio = a capo)"></textarea>
        <button class="send-btn" id="btnSend">Invia</button>
      </div>
      <div class="status-line"><span id="statusLeft"></span><span id="statusRight"></span></div>
    </div>
  </main>

  <!-- Modal nuova chat -->
  <div class="modal-backdrop hidden" id="modalNewChat">
    <div class="modal">
      <h2>Nuova Chat</h2>
      <div>
        <label for="meetingSelect">Trascrizione meeting</label>
        <select id="meetingSelect"></select>
      </div>
      <div>
        <label for="chatName">Titolo chat</label>
        <input id="chatName" placeholder="Titolo" />
      </div>
      <div class="modal-actions">
        <button class="btn" id="cancelNewChat">Annulla</button>
        <button class="btn primary" id="createNewChat">Crea</button>
      </div>
    </div>
  </div>

  <!-- Modal rinomina chat -->
  <div class="modal-backdrop hidden" id="modalRenameChat">
    <div class="modal">
      <h2>Rinomina Chat</h2>
      <div>
        <label for="renameChatInput">Nuovo titolo</label>
        <input id="renameChatInput" placeholder="Titolo" />
      </div>
      <div class="modal-actions">
        <button class="btn" id="cancelRenameChat">Annulla</button>
        <button class="btn primary" id="applyRenameChat">Salva</button>
      </div>
    </div>
  </div>

  <!-- Modal elimina chat -->
  <div class="modal-backdrop hidden" id="modalDeleteChat">
    <div class="modal">
      <h2>Elimina Chat</h2>
      <p style="margin:0;font-size:.8rem;">Confermi l'eliminazione definitiva di questa chat?</p>
      <div class="modal-actions">
        <button class="btn" id="cancelDeleteChat">Annulla</button>
        <button class="btn danger" id="confirmDeleteChat">Elimina</button>
      </div>
    </div>
  </div>

  <script type="module" src="./LLM/llm.js"></script>
  <script type="module" src="./chat.js"></script>
</body>
</html>
